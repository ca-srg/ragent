# RAGent SQLite データ閲覧ガイド

## データベース情報

| 項目 | 値 |
|------|-----|
| ファイル | `~/.ragent/stats.db` |
| ドライバー | `modernc.org/sqlite` |
| 用途 | メトリクス（呼び出し統計）の永続化 |

## テーブル構造

```sql
CREATE TABLE IF NOT EXISTS invocation_counts (
    mode TEXT NOT NULL,      -- 呼び出しモード: mcp, slack, query, chat
    date TEXT NOT NULL,      -- 日付: YYYY-MM-DD形式
    count INTEGER DEFAULT 0, -- その日の呼び出し回数
    PRIMARY KEY (mode, date)
);
```

## データ閲覧用SQL

### 1. 全データ一覧

```sql
SELECT * FROM invocation_counts ORDER BY date DESC, mode;
```

### 2. モード別累計回数

```sql
SELECT mode, SUM(count) as total_count 
FROM invocation_counts 
GROUP BY mode 
ORDER BY total_count DESC;
```

### 3. 日別の全モード合計

```sql
SELECT date, SUM(count) as daily_total 
FROM invocation_counts 
GROUP BY date 
ORDER BY date DESC;
```

### 4. 特定モードの履歴（例: mcp）

```sql
SELECT date, count 
FROM invocation_counts 
WHERE mode = 'mcp' 
ORDER BY date DESC;
```

### 5. 今日のカウント

```sql
SELECT mode, count 
FROM invocation_counts 
WHERE date = date('now') 
ORDER BY count DESC;
```

### 6. 直近7日間の統計

```sql
SELECT date, mode, count 
FROM invocation_counts 
WHERE date >= date('now', '-7 days') 
ORDER BY date DESC, mode;
```

### 7. 直近30日間のモード別合計

```sql
SELECT mode, SUM(count) as monthly_total 
FROM invocation_counts 
WHERE date >= date('now', '-30 days') 
GROUP BY mode 
ORDER BY monthly_total DESC;
```

## CLIでの実行方法

```bash
# sqlite3コマンドで接続
sqlite3 ~/.ragent/stats.db

# ワンライナーで実行
sqlite3 ~/.ragent/stats.db "SELECT * FROM invocation_counts ORDER BY date DESC;"

# 表形式で見やすく表示
sqlite3 -header -column ~/.ragent/stats.db "SELECT * FROM invocation_counts;"

# CSV形式で出力
sqlite3 -header -csv ~/.ragent/stats.db "SELECT * FROM invocation_counts;" > stats.csv
```
